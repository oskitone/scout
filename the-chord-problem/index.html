<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.69">
<title data-react-helmet="true">The chord problem | Oskitone Scout Assembly Guide</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="The chord problem | Oskitone Scout Assembly Guide"><meta data-react-helmet="true" name="description" content="Sometimes playing specific chords"><meta data-react-helmet="true" property="og:description" content="Sometimes playing specific chords"><meta data-react-helmet="true" property="og:image" content="https://oskitone.github.io/scout/img/scout-10-838-032.gif"><meta data-react-helmet="true" property="twitter:image" content="https://oskitone.github.io/scout/img/scout-10-838-032.gif"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for The chord problem"><meta data-react-helmet="true" property="og:url" content="https://oskitone.github.io/scout/the-chord-problem"><link data-react-helmet="true" rel="shortcut icon" href="/scout/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://oskitone.github.io/scout/the-chord-problem"><link rel="stylesheet" href="/scout/styles.dca57809.css">
<link rel="preload" href="/scout/styles.91e23198.js" as="script">
<link rel="preload" href="/scout/runtime~main.1616ea0b.js" as="script">
<link rel="preload" href="/scout/main.b0017101.js" as="script">
<link rel="preload" href="/scout/1.2b4785bd.js" as="script">
<link rel="preload" href="/scout/33.4a551976.js" as="script">
<link rel="preload" href="/scout/935f2afb.08569bbc.js" as="script">
<link rel="preload" href="/scout/32.bc5dce58.js" as="script">
<link rel="preload" href="/scout/3284ddf3.f29e4a23.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_2AhQ">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/scout/"><strong class="navbar__title">Oskitone Scout Assembly Guide</strong></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/scout/"><strong class="navbar__title">Oskitone Scout Assembly Guide</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive thin-scrollbar menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scout/">What You&#x27;ll Be Making</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scout/inventory">Inventory</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">3D-Printing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scout/3d-printing-parts-and-slicing">Parts and Slicing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scout/3d-printing-post-processing">Post-Processing</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">PCB Assembly</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scout/general-tips">General tips and getting started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scout/assemble-battery-pack">Assemble battery pack</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scout/power-up">Power up</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scout/boot-the-microcontroller">Boot the microcontroller</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scout/get-logical">Get logical</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scout/make-some-noise">Make some noise</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scout/get-loud">Get loud</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scout/more-notes">More notes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scout/get-louder">Get louder</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scout/prep-for-hacking">Prep for hacking</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Assembly</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scout/assemble-top">Assemble top</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scout/assemble-bottom">Assemble bottom</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scout/final-assembly">Final assembly</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scout/care">Care</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Hacking</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scout/change-the-arduino-code">Change the Arduino code</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scout/community-hacks">Community hacks</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Appendix</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/scout/bom">Annotated BOM</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/scout/pcb-troubleshooting">PCB troubleshooting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/scout/assembly-troubleshooting">Assembly troubleshooting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/scout/opening-the-enclosure">Opening the enclosure</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/scout/the-chord-problem">The chord problem</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/scout/schematics">Schematics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/scout/source-and-license">Source and License</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_39qw"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">The chord problem</h1></header><div class="markdown"><p>The Scout is monophonic; it can only play one note at a time. If you try to hold multiple notes simultaneously, it tries to do what&#x27;s called &quot;last note priority&quot; and only plays the most recently held key&#x27;s note.</p><p>But sometimes, specific chords or sets of keys seem to add a note that you hadn&#x27;t anticipated.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="reproduce-the-issue"></a>Reproduce the issue<a class="hash-link" href="#reproduce-the-issue" title="Direct link to heading">#</a></h2><ol><li>Play the first three white keys individually in succession. <strong>C</strong>, then <strong>D</strong>, then <strong>E</strong>. They should sound exactly as you&#x27;d expect.</li><li>Now, play them together. <strong>C</strong> <em>and</em> <strong>D</strong> <em>and</em> <strong>E</strong>.</li><li>Notice that it plays a totally different note at the end there instead of <strong>E</strong>. If you continue playing keys up individually, you&#x27;ll discover that we got an <strong>F#</strong> at the end instead of the E we were expecting.</li><li>Now play the same run of those first three white keys but in the reverse order. <strong>E</strong> <em>and</em> <strong>D</strong> <em>and</em> <strong>C</strong>.</li><li>Again, notice that the third note at the end is <strong>F#</strong>.</li></ol><p>Super weird, right? Why is this happening?</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="debugging-with-the-serial-monitor"></a>Debugging with the serial monitor<a class="hash-link" href="#debugging-with-the-serial-monitor" title="Direct link to heading">#</a></h2><p>If we <a href="/scout/change-the-arduino-code#serial-debugging">log out the indexes of the buttons</a> being pressed and play <strong>C</strong>, <strong>D</strong>, <strong>E</strong> individually it looks like this:</p><p><a target="_blank" href="/scout/assets/files/chord-individual-d1b8d3daf964bb003c8c19e5a45bf169.png"><img alt="Screengrab of the Arduino serial monitor while playing C, D, and E individually" src="/scout/assets/images/chord-individual-d1b8d3daf964bb003c8c19e5a45bf169.png"></a></p><p>Makes sense. <strong>0</strong> is <strong>C</strong>, <strong>2</strong> is <strong>D</strong>, and <strong>4</strong> is <strong>E</strong>. That&#x27;s just what we expected! (In code, we order lists starting at 0 instead of 1, so the indexes of the list of 17 keys go from 0 to 16, not 1 to 17.)</p><p>But holding them together looks like this:</p><p><a target="_blank" href="/scout/assets/files/chord-cde-cf0be930ccf28f7421ea390fc94e4e58.png"><img alt="Screengrab of the Arduino serial monitor while playing C, D, and E together" src="/scout/assets/images/chord-cde-cf0be930ccf28f7421ea390fc94e4e58.png"></a></p><p>The <strong>0</strong>, <strong>2</strong>, <strong>4</strong> are in there (reverse ordered but that&#x27;s irrelevant) but we also see a fourth index, <strong>6</strong>. That&#x27;s the index of the <strong>F#</strong> key.</p><p>Playing and holding <strong>E</strong>, <strong>D</strong>, <strong>C</strong> is the same with a different order:</p><p><a target="_blank" href="/scout/assets/files/chord-edc-a990320844d6d87aad08600f241ebfde.png"><img alt="Screengrab of the Arduino serial monitor while playing E, D, and C together" src="/scout/assets/images/chord-edc-a990320844d6d87aad08600f241ebfde.png"></a></p><p>That doesn&#x27;t solve our problem, but it does tell us that the microcontroller is indeed interpreting that the <strong>C</strong>, <strong>D</strong>, and <strong>E</strong> keys are being pressed but, for some reason, incorrectly <em>adding</em> the <strong>F#</strong>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="checking-the-schematic"></a>Checking the schematic<a class="hash-link" href="#checking-the-schematic" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="a-matrix-of-keys"></a>A matrix of keys<a class="hash-link" href="#a-matrix-of-keys" title="Direct link to heading">#</a></h3><p>The Scout has 17 keys but they only take up 9 pins on the ATmega328. It does this by convincing the microcontroller that the 17 keys are arranged in a matrix of rows and columns: 4 rows * 5 columns = 20 possible keys.</p><p>When a key is pressed and its switch closes, the pins for its row and column connect.</p><p>The matrix of rows and columns with the notes labelled, read from top to bottom and <em>then</em> left to right:</p><p><a target="_blank" href="/scout/assets/files/matrix-ce640ae3f304c5a0741ea7217c39c2b2.png"><img alt="Matrix schematic with switches labelled to their corresponding notes" src="/scout/assets/images/matrix-ce640ae3f304c5a0741ea7217c39c2b2.png"></a></p><ul><li><strong>Note 1:</strong> The ATmega328 only has 14 digital input/output (IO) pins, which wouldn&#x27;t be enough for all the keys if they were wired individually. There are other ways besides a matrix to get more IO out of our chip but they all require soldering more components.</li><li><strong>Note 2:</strong> The 3 remaining, unused matrix spots in the bottom right are available for use on the <a href="/scout/change-the-arduino-code#pins">&quot;HACK&quot; header</a>.</li><li><strong>Note 3:</strong> Awkwardly, the hardware components for the notes are indexed from SW2 to SW18, because only the code uses zero-indexing and the on/off switch was SW1. Thankfully, at least they are still in linear order!</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="connecting-rows-and-columns"></a>Connecting rows and columns<a class="hash-link" href="#connecting-rows-and-columns" title="Direct link to heading">#</a></h3><p>We can see that <strong>C</strong> is <strong>R1C1</strong> (Row 1, column 1), <strong>D</strong> is <strong>R3C1</strong>, and <strong>E</strong> is <strong>R1C2</strong>.</p><p><a target="_blank" href="/scout/assets/files/matrix-trio-f394787ec815be24dd67b81fe8e43ce7.png"><img alt="Matrix schematic with C, D, and E matrix points highlighted" src="/scout/assets/images/matrix-trio-f394787ec815be24dd67b81fe8e43ce7.png"></a></p><p>But to the microcontroller, it also sure looks like you&#x27;re pressing <strong>F#</strong> at <strong>R3C2</strong>. I mean, how could it know you&#x27;re not? So it just throws it in there.</p><p><a target="_blank" href="/scout/assets/files/matrix-f_sharp-97db287e089fb133039c3aaa7dcec79c.png"><img alt="Matrix schematic with C, D, and E matrix points highlighted" src="/scout/assets/images/matrix-f_sharp-97db287e089fb133039c3aaa7dcec79c.png"></a></p><p>That&#x27;s the culprit!!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="is-it-a-bug"></a>Is it a bug?<a class="hash-link" href="#is-it-a-bug" title="Direct link to heading">#</a></h2><p>Issues like this &quot;chord problem&quot; are normally avoided on more complex matrix circuits like your computer keyboard with diodes along the switches, but these were ommitted on the Scout to cut down on kit cost and assembly time. The Scout&#x27;s monophony was an intentional limitation to deter encountering it. After all, <em>it is supposed to be simple instrument</em>!</p><p>So it&#x27;s <em>kind of</em> a bug but <em>more</em> like a &quot;known issue&quot; and a cost to be paid for the simplicity of the Scout&#x27;s assembly.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="homework"></a>Homework<a class="hash-link" href="#homework" title="Direct link to heading">#</a></h3><p>Looking at the matrix schematic, can you find other key combinations that will have the &quot;chord problem&quot;?</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/scout/opening-the-enclosure"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Opening the enclosure</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/scout/schematics"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Schematics Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_ thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#reproduce-the-issue" class="table-of-contents__link">Reproduce the issue</a></li><li><a href="#debugging-with-the-serial-monitor" class="table-of-contents__link">Debugging with the serial monitor</a></li><li><a href="#checking-the-schematic" class="table-of-contents__link">Checking the schematic</a><ul><li><a href="#a-matrix-of-keys" class="table-of-contents__link">A matrix of keys</a></li><li><a href="#connecting-rows-and-columns" class="table-of-contents__link">Connecting rows and columns</a></li></ul></li><li><a href="#is-it-a-bug" class="table-of-contents__link">Is it a bug?</a><ul><li><a href="#homework" class="table-of-contents__link">Homework</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div>Copyright Â© 2023 Oskitone. Built with Docusaurus.</div></div></div></footer></div>
<script src="/scout/styles.91e23198.js"></script>
<script src="/scout/runtime~main.1616ea0b.js"></script>
<script src="/scout/main.b0017101.js"></script>
<script src="/scout/1.2b4785bd.js"></script>
<script src="/scout/33.4a551976.js"></script>
<script src="/scout/935f2afb.08569bbc.js"></script>
<script src="/scout/32.bc5dce58.js"></script>
<script src="/scout/3284ddf3.f29e4a23.js"></script>
</body>
</html>